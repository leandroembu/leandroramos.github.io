<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Construindo seu primeiro Flatpak</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Construindo seu primeiro Flatpak</h1>
</header>
<section data-field="subtitle" class="p-summary">
Depois de uma semana testando o Fedora Silverblue em duas máquinas, passei a usar vários pacotes Flatpak, pois precisava conhecer melhor…
</section>
<section data-field="body" class="e-content">
<section name="e493" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="1a53" id="1a53" class="graf graf--h3 graf--leading graf--title">Construindo seu primeiro Flatpak</h3><figure name="198f" id="198f" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 620px; max-height: 348px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.10000000000001%;"></div><img class="graf-image" data-image-id="0*FiwtrR8ZyDlYN7X4.jpg" data-width="620" data-height="348" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*FiwtrR8ZyDlYN7X4.jpg"></div><figcaption class="imageCaption">Logo do Flatpak</figcaption></figure><p name="17c8" id="17c8" class="graf graf--p graf-after--figure">Se quiserem me doar um café pelo PagSeguro do UOL: <a href="https://pag.ae/7Vu8Tt-pn" data-href="https://pag.ae/7Vu8Tt-pn" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://pag.ae/7Vu8Tt-pn</a></p><p name="ecbe" id="ecbe" class="graf graf--p graf-after--p">Depois de uma semana testando o Fedora Silverblue em duas máquinas, passei a usar vários pacotes Flatpak, pois precisava conhecer melhor seu funcionamento. Eu sou meio “das antigas” e prefiro usar os pacotes do repositório da distribuição Linux que estiver usando (no Fedora temos um repositório de flatpaks também, ainda pequeno). No entanto, não posso negar que existem vantagens no uso dos Flatpaks — as quais não vou abordar aqui para não sair do foco do artigo.</p><p name="0ec6" id="0ec6" class="graf graf--p graf-after--p">O tutorial a seguir é praticamente uma tradução da documentação presente no link <a href="http://docs.flatpak.org/en/latest/first-build.html" data-href="http://docs.flatpak.org/en/latest/first-build.html" class="markup--anchor markup--p-anchor" rel="nofollow noopener noopener" target="_blank">http://docs.flatpak.org/en/latest/first-build.html</a></p><h4 name="e0d9" id="e0d9" class="graf graf--h4 graf-after--p">Ferramentas necessárias</h4><p name="4c7e" id="4c7e" class="graf graf--p graf-after--h4">Precisamos do <strong class="markup--strong markup--p-strong">flatpak</strong> e do <strong class="markup--strong markup--p-strong">flatpak-builder</strong>. No meu sistema (Fedora 31 Workstation), eles já vem instalados. Veja como instalar no seu sistema — provavelmente os dois pacotes estão nos repositórios da maioria das distribuições Linux, ou você pode instalar o flatpak-builder como qualquer flatpak</p><p name="5fe8" id="5fe8" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">flatpak install flathub org.flatpak.Builder</code></p><h4 name="96d6" id="96d6" class="graf graf--h4 graf-after--p">Instalando o SDK necessário</h4><p name="55e9" id="55e9" class="graf graf--p graf-after--h4">Para construirmos nosso programa flatpak, vamos precisar do SDK apropriado para isso. Aqui temos um ponto bastante discutido na comunidade, o tamanho dos SDKs e Runtimes, mas isso será debatido em outras mídias (offtopic).</p><pre name="67ea" id="67ea" class="graf graf--pre graf-after--p">flatpak install flathub org.freedesktop.Platform//18.08 org.freedesktop.Sdk//18.08</pre><figure name="a73f" id="a73f" class="graf graf--figure graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 189px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 27%;"></div><img class="graf-image" data-image-id="1*krSGhfBclGz_iz6BdNwmZw.png" data-width="1920" data-height="519" src="https://cdn-images-1.medium.com/max/800/1*krSGhfBclGz_iz6BdNwmZw.png"></div><figcaption class="imageCaption">Instalação do SDK necessário para fazermos o build do programa</figcaption></figure><h4 name="ba27" id="ba27" class="graf graf--h4 graf-after--figure">Criando o programa</h4><p name="bba4" id="bba4" class="graf graf--p graf-after--h4">Sugiro que você organize seus arquivos em algum diretório, para que não fiquem misturados com outras coisas.</p><figure name="0eb4" id="0eb4" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 190px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 27.200000000000003%;"></div><img class="graf-image" data-image-id="1*1hlu_9eGC0_pF5tbMQHtvw.png" data-width="1101" data-height="299" src="https://cdn-images-1.medium.com/max/800/1*1hlu_9eGC0_pF5tbMQHtvw.png"></div><figcaption class="imageCaption">Meu projeto em ~/projetos/flatpaks/org.leandroramos.Infoscript</figcaption></figure><p name="579f" id="579f" class="graf graf--p graf-after--figure">Dentro do diretório que escolhemos, vamos escrever o script, será um script em shell Bash para homenagear meu querido professor Blau Araújo, com quem faço um curso — <a href="https://debxp-linux.blogspot.com/" data-href="https://debxp-linux.blogspot.com/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://debxp-linux.blogspot.com/</a></p><p name="c032" id="c032" class="graf graf--p graf-after--p">Vamos criar o arquivo infoscript.sh e colocar o seguinte conteúdo:</p><pre name="d811" id="d811" class="graf graf--pre graf-after--p">#!/usr/bin/env bash<br>clear<br>echo “”<br>echo “Informações super importantes!”<br>echo “ — — — — — — — — — — — — — — — — — — -”<br>echo -n “Usuário : “<br>whoami<br>echo -n “Hostname: “<br>hostname<br>echo -n “Uptime : “<br>uptime -p<br>echo -n “Kernel : “<br>uname -rms<br>echo “ — — — — — — — — — — — — — — — — — — -”<br>echo “”</pre><figure name="830d" id="830d" class="graf graf--figure graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 394px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.3%;"></div><img class="graf-image" data-image-id="1*cvlTnUr5a7a-Nojdxfzjrg.png" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*cvlTnUr5a7a-Nojdxfzjrg.png"></div><figcaption class="imageCaption">Script no editor de textos</figcaption></figure><h4 name="d957" id="d957" class="graf graf--h4 graf-after--figure">Criando o “manifesto”</h4><p name="e526" id="e526" class="graf graf--p graf-after--h4">Todo pacote flatpak é construído usando um arquivo manifest que possui informações básicas sobre o programa e instruções para que ele seja construído (ou, no novo verbo, “buildado”). Vamos criar o arquivo org.leandroramos.Infoscript.json (OK, não precisam usar o meu nome aqui) no mesmo diretório onde colocamos o infoscript.sh, e adicionar o seguinte conteúdo (adapte para o seu uso aí):</p><pre name="c54f" id="c54f" class="graf graf--pre graf-after--p">{<br>    &quot;app-id&quot;: &quot;org.leandroramos.Infoscript&quot;,<br>    &quot;runtime&quot;: &quot;org.freedesktop.Platform&quot;,<br>    &quot;runtime-version&quot;: &quot;18.08&quot;,<br>    &quot;sdk&quot;: &quot;org.freedesktop.Sdk&quot;,<br>    &quot;command&quot;: &quot;<strong class="markup--strong markup--pre-strong">infoscript.sh</strong>&quot;,<br>    &quot;modules&quot;: [<br>        {<br>            &quot;name&quot;: &quot;<strong class="markup--strong markup--pre-strong">infoscript</strong>&quot;,<br>            &quot;buildsystem&quot;: &quot;simple&quot;,<br>            &quot;build-commands&quot;: [<br>                &quot;install -D infoscript.sh /app/bin/<strong class="markup--strong markup--pre-strong">infoscript.sh</strong>&quot;<br>            ],<br>            &quot;sources&quot;: [<br>                {<br>                    &quot;type&quot;: &quot;file&quot;,<br>                    &quot;path&quot;: &quot;<strong class="markup--strong markup--pre-strong">infoscript.sh</strong>&quot;<br>                }<br>            ]<br>        }<br>    ]<br>}</pre><figure name="a53a" id="a53a" class="graf graf--figure graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 394px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.3%;"></div><img class="graf-image" data-image-id="1*Kr9fBl5A_uS__-UNRFd1yg.png" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*Kr9fBl5A_uS__-UNRFd1yg.png"></div><figcaption class="imageCaption">Manifesto json no editor de textos</figcaption></figure><h4 name="470b" id="470b" class="graf graf--h4 graf-after--figure">Construindo o programa (build)</h4><p name="de8e" id="de8e" class="graf graf--p graf-after--h4">Agora que o nosso programa tem um manifesto, o flatpak-builder pode construir o pacote. Ao especificar o build-dir (que pode ter outro nome), teremos um diretório com o build do programa.</p><pre name="8814" id="8814" class="graf graf--pre graf-after--p">flatpak-builder build-dir org.leandroramos.Infoscript.json</pre><figure name="1e47" id="1e47" class="graf graf--figure graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 255px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 36.4%;"></div><img class="graf-image" data-image-id="1*8_9AiAliZOwd5WHsS2l15w.png" data-width="1697" data-height="617" src="https://cdn-images-1.medium.com/max/800/1*8_9AiAliZOwd5WHsS2l15w.png"></div><figcaption class="imageCaption">Build concluído</figcaption></figure><figure name="1302" id="1302" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 390px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 55.7%;"></div><img class="graf-image" data-image-id="1*QR15AmnKKOmIJM2uUSbG2w.png" data-width="1132" data-height="631" src="https://cdn-images-1.medium.com/max/800/1*QR15AmnKKOmIJM2uUSbG2w.png"></div><figcaption class="imageCaption">Conteúdo do build-dir</figcaption></figure><h4 name="3db2" id="3db2" class="graf graf--h4 graf-after--figure">Testando o build do programa</h4><p name="354d" id="354d" class="graf graf--p graf-after--h4">Me perdoem por misturar as palavras construção e build, mas acho que não devo mais traduzir assim.</p><p name="73a5" id="73a5" class="graf graf--p graf-after--p">Para testar o programa, vamos usar o flatpak-builder. Usando o parâmetro run, o programa terá quase as mesmas permissões de um programa final, exceto as permissões de acesso ao sistema de arquivos.</p><pre name="cf27" id="cf27" class="graf graf--pre graf-after--p">flatpak-builder --run build-dir org.leandroramos.Infoscript.json infoscript.sh</pre><figure name="deae" id="deae" class="graf graf--figure graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 468px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 66.9%;"></div><img class="graf-image" data-image-id="1*2l6J_HYZ7IYF6aMh5QNSyg.png" data-width="712" data-height="476" src="https://cdn-images-1.medium.com/max/800/1*2l6J_HYZ7IYF6aMh5QNSyg.png"></div><figcaption class="imageCaption">Primeiro programa Flatpak funcionando</figcaption></figure><h4 name="86a0" id="86a0" class="graf graf--h4 graf-after--figure">Colocando o pacote num repositório</h4><p name="903e" id="903e" class="graf graf--p graf-after--h4">Antes de podermos instalar e rodar o programa, ele precisa estar em um repositório. Vamos criar um repositório local para o nosso primeiro programa, e devo lembrar que você pode colocar o nome que quiser no repositório, pois estamos trabalhando localmente.</p><pre name="6c40" id="6c40" class="graf graf--pre graf-after--p">flatpak-builder --repo=leandroramos --force-clean build-dir org.leandroramos.Infoscript.json</pre><p name="4cf5" id="4cf5" class="graf graf--p graf-after--pre">O comando acima vai fazer o build novamente e exportar o resultado para um diretório chamado <em class="markup--em markup--p-em">leandroramos</em> — que é o meu repositório local. O segundo parâmetro (force-clean) vai esvaziar o diretório build-dir criado anteriormente.</p><figure name="9259" id="9259" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 228px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 32.6%;"></div><img class="graf-image" data-image-id="1*cdqjpkPcqPpkcz9wBM3sPQ.png" data-width="1819" data-height="593" src="https://cdn-images-1.medium.com/max/800/1*cdqjpkPcqPpkcz9wBM3sPQ.png"></div><figcaption class="imageCaption">Colocando o programa no repositório</figcaption></figure><figure name="f203" id="f203" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 409px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 58.4%;"></div><img class="graf-image" data-image-id="1*nDIB0_1Z8wyxNzbgidjboQ.png" data-width="1234" data-height="721" src="https://cdn-images-1.medium.com/max/800/1*nDIB0_1Z8wyxNzbgidjboQ.png"></div><figcaption class="imageCaption">Conteúdo do repositório leandroramos</figcaption></figure><h4 name="5090" id="5090" class="graf graf--h4 graf-after--figure">Instalando o programa</h4><p name="03fc" id="03fc" class="graf graf--p graf-after--h4">Antes de instalarmos o programa, como todo flatpak, precisamos adicionar o repositório à nossa lista de remotos (você pode consultar a página <a href="http://docs.flatpak.org/en/latest/using-flatpak.html" data-href="http://docs.flatpak.org/en/latest/using-flatpak.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Using Flatpak</a> para entender melhor).</p><pre name="7d7e" id="7d7e" class="graf graf--pre graf-after--p">flatpak --user remote-add --no-gpg-verify leandroramos leandroramos</pre><p name="e42f" id="e42f" class="graf graf--p graf-after--pre">Depois podemos listar os remotos para conferir se o novo repositório foi adicionado</p><pre name="6a13" id="6a13" class="graf graf--pre graf-after--p">flatpak remotes</pre><p name="1537" id="1537" class="graf graf--p graf-after--pre">E, depois, podemos instalar o programa</p><pre name="8bab" id="8bab" class="graf graf--pre graf-after--p">flatpak --user install leandroramos org.leandroramos.Infoscript</pre><figure name="8de9" id="8de9" class="graf graf--figure graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 227px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 32.5%;"></div><img class="graf-image" data-image-id="1*OUGIEh8rhHMezvrGEIkZ1A.png" data-width="1555" data-height="505" src="https://cdn-images-1.medium.com/max/800/1*OUGIEh8rhHMezvrGEIkZ1A.png"></div><figcaption class="imageCaption">Instalando o programa Infoscript a partir do repositório leandroramos</figcaption></figure><p name="37b5" id="37b5" class="graf graf--p graf-after--figure">Note que passamos o parâmetro <code class="markup--code markup--p-code">--no-gpg-verify</code>quando adicionamos o repositório <em class="markup--em markup--p-em">leandroramos</em> à lista de remotos do flatpak. Faça isso somente em testes locais. Para publicar programas em repositórios oficiais você deve assinar os pacotes com chave privada GPG.</p><h4 name="5764" id="5764" class="graf graf--h4 graf-after--p">Finalmente, rodando o programa</h4><p name="426c" id="426c" class="graf graf--p graf-after--h4">O nosso programa não possui lançadores nem integração alguma com o sistema, e nem precisaria no momento. Então, vamos executá-lo a partir do terminal (a partir de qualquer lugar do sistema, não precisamos mais estar no diretório de criação do pacote).</p><pre name="8ac7" id="8ac7" class="graf graf--pre graf-after--p">flatpak run org.leandroramos.Infoscript</pre><figure name="047b" id="047b" class="graf graf--figure graf-after--pre"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 157px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 22.5%;"></div><img class="graf-image" data-image-id="1*LcRBNo9E5jaDJbtmDNtVDQ.png" data-width="845" data-height="190" src="https://cdn-images-1.medium.com/max/800/1*LcRBNo9E5jaDJbtmDNtVDQ.png"></div><figcaption class="imageCaption">Comando para rodar o programa Infoscript</figcaption></figure><figure name="9547" id="9547" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 432px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 61.7%;"></div><img class="graf-image" data-image-id="1*nXAvjtpi1LQxBsCqoHJCPA.png" data-width="741" data-height="457" src="https://cdn-images-1.medium.com/max/800/1*nXAvjtpi1LQxBsCqoHJCPA.png"></div><figcaption class="imageCaption">Execução do programa Infoscript</figcaption></figure><p name="25e5" id="25e5" class="graf graf--p graf-after--figure graf--trailing">Por enquanto é só, pessoal. Abraços!</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@leandroembu" class="p-author h-card">Leandro Ramos</a> on <a href="https://medium.com/p/47ae2d13d6b8"><time class="dt-published" datetime="2019-11-20T13:59:41.266Z">November 20, 2019</time></a>.</p><p><a href="https://medium.com/@leandroembu/construindo-seu-primeiro-flatpak-47ae2d13d6b8" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 12, 2019.</p></footer></article></body></html>